<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Complet - Gestion Relation Client</title>

    <!-- Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --success: #22c55e;
            --bg: #f8fafc;
            --sidebar-bg: #1e293b;
            --sidebar-hover: #334155;
            --text: #1e293b;
            --text-light: #64748b;
            --white: #ffffff;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --secondary: #10b981;
            --bg: #0f172a;
            --sidebar-bg: #020617;
            --sidebar-hover: #1e293b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --white: #1e293b;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: var(--sidebar-hover);
            color: white;
            border-left: 4px solid var(--primary);
        }

        .sidebar-menu .icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 30px;
            width: calc(100% - 260px);
        }

        /* Header */
        .header {
            background: var(--white);
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h2 {
            font-size: 28px;
            color: var(--text);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px var(--shadow);
        }

        .stat-card.success {
            border-left-color: var(--success);
        }

        .stat-card.warning {
            border-left-color: var(--warning);
        }

        .stat-card.info {
            border-left-color: var(--info);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-light);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text);
        }

        .stat-change {
            font-size: 12px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Content Card */
        .content-card {
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }

        .card-body {
            padding: 25px;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg);
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-light);
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        tbody tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: var(--bg);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            font-size: 14px;
            color: var(--text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--white);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(6, 182, 212, 0.1);
            color: var(--info);
        }

        .badge-primary {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        /* Search Bar */
        .search-bar {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-bar input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--white);
            color: var(--text);
        }

        .search-bar::after {
            content: "üîç";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }

        /* Theme Toggle */
        .theme-toggle {
            width: 50px;
            height: 26px;
            background: var(--border);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle::after {
            content: "‚òÄÔ∏è";
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        [data-theme="dark"] .theme-toggle {
            background: var(--primary);
        }

        [data-theme="dark"] .theme-toggle::after {
            content: "üåô";
            left: 27px;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .chart-container h4 {
            font-size: 16px;
            margin-bottom: 20px;
            color: var(--text);
        }

        /* Activity Timeline */
        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -35px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--white);
            box-shadow: 0 0 0 2px var(--primary);
        }

        .timeline-content {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
        }

        .timeline-date {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: var(--white);
            color: var(--text);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--text);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                padding: 0;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }

            .header {
                padding: 15px;
            }

            .header h2 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Hide inactive sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Action buttons in table */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--bg);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>üìä CRM Pro</h1>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" class="nav-link active" data-section="dashboard">
                <span class="icon">üìà</span> Tableau de bord
            </a></li>
            <li><a href="#" class="nav-link" data-section="clients">
                <span class="icon">üë•</span> Clients
            </a></li>
            <li><a href="#" class="nav-link" data-section="contacts">
                <span class="icon">üìá</span> Contacts
            </a></li>
            <li><a href="#" class="nav-link" data-section="opportunities">
                <span class="icon">üíº</span> Opportunit√©s
            </a></li>
            <li><a href="#" class="nav-link" data-section="activities">
                <span class="icon">üìû</span> Activit√©s
            </a></li>
            <li><a href="#" class="nav-link" data-section="tasks">
                <span class="icon">‚úì</span> T√¢ches
            </a></li>
            <li><a href="#" class="nav-link" data-section="reports">
                <span class="icon">üìä</span> Rapports
            </a></li>
            <li><a href="#" class="nav-link" data-section="settings">
                <span class="icon">‚öôÔ∏è</span> Param√®tres
            </a></li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="header">
                <h2>Tableau de bord</h2>
                <div class="header-actions">
                    <div class="search-bar">
                        <input type="text" placeholder="Rechercher...">
                    </div>
                    <div class="theme-toggle" id="themeToggle"></div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">üë•</span>
                    <div class="stat-label">Total Clients</div>
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-change positive">‚Üë +12% ce mois</div>
                </div>
                <div class="stat-card success">
                    <span class="stat-icon">üí∞</span>
                    <div class="stat-label">Revenus (CA)</div>
                    <div class="stat-value" id="totalRevenue">0‚Ç¨</div>
                    <div class="stat-change positive">‚Üë +8.5% ce mois</div>
                </div>
                <div class="stat-card warning">
                    <span class="stat-icon">üíº</span>
                    <div class="stat-label">Opportunit√©s actives</div>
                    <div class="stat-value" id="activeOpportunities">0</div>
                    <div class="stat-change">‚Üí Stable</div>
                </div>
                <div class="stat-card info">
                    <span class="stat-icon">‚úì</span>
                    <div class="stat-label">T√¢ches aujourd'hui</div>
                    <div class="stat-value" id="tasksToday">0</div>
                    <div class="stat-change negative">5 en retard</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h4>Revenus mensuels</h4>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Opportunit√©s par statut</h4>
                    <canvas id="opportunitiesChart"></canvas>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="content-card">
                <div class="card-header">
                    <h3>Activit√©s r√©centes</h3>
                    <button class="btn btn-small btn-outline">Voir tout</button>
                </div>
                <div class="card-body">
                    <div class="timeline" id="recentActivities">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Clients Section -->
        <section id="clients" class="section">
            <div class="header">
                <h2>Gestion des clients</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openModal('clientModal')">
                        ‚ûï Nouveau client
                    </button>
                    <button class="btn btn-outline" onclick="exportData('clients')">
                        üì• Exporter
                    </button>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <div class="search-bar">
                        <input type="text" id="clientSearch" placeholder="Rechercher un client..." onkeyup="filterClients()">
                    </div>
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterClientsByStatus('all')">Tous</button>
                        <button class="filter-btn" onclick="filterClientsByStatus('actif')">Actifs</button>
                        <button class="filter-btn" onclick="filterClientsByStatus('inactif')">Inactifs</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Entreprise</th>
                                    <th>Statut</th>
                                    <th>CA Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clientsTableBody">
                                <!-- Clients will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contacts Section -->
        <section id="contacts" class="section">
            <div class="header">
                <h2>Gestion des contacts</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openModal('contactModal')">
                        ‚ûï Nouveau contact
                    </button>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <div class="search-bar">
                        <input type="text" id="contactSearch" placeholder="Rechercher un contact..." onkeyup="filterContacts()">
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>T√©l√©phone</th>
                                    <th>Poste</th>
                                    <th>Client</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contactsTableBody">
                                <!-- Contacts will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Opportunities Section -->
        <section id="opportunities" class="section">
            <div class="header">
                <h2>Gestion des opportunit√©s</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openModal('opportunityModal')">
                        ‚ûï Nouvelle opportunit√©
                    </button>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <div class="search-bar">
                        <input type="text" id="opportunitySearch" placeholder="Rechercher une opportunit√©..." onkeyup="filterOpportunities()">
                    </div>
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterOpportunitiesByStatus('all')">Toutes</button>
                        <button class="filter-btn" onclick="filterOpportunitiesByStatus('prospection')">Prospection</button>
                        <button class="filter-btn" onclick="filterOpportunitiesByStatus('qualification')">Qualification</button>
                        <button class="filter-btn" onclick="filterOpportunitiesByStatus('proposition')">Proposition</button>
                        <button class="filter-btn" onclick="filterOpportunitiesByStatus('n√©gociation')">N√©gociation</button>
                        <button class="filter-btn" onclick="filterOpportunitiesByStatus('gagn√©')">Gagn√©</button>
                        <button class="filter-btn" onclick="filterOpportunitiesByStatus('perdu')">Perdu</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Titre</th>
                                    <th>Client</th>
                                    <th>Montant</th>
                                    <th>Probabilit√©</th>
                                    <th>Statut</th>
                                    <th>Date de cl√¥ture</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="opportunitiesTableBody">
                                <!-- Opportunities will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Activities Section -->
        <section id="activities" class="section">
            <div class="header">
                <h2>Suivi des activit√©s</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openModal('activityModal')">
                        ‚ûï Nouvelle activit√©
                    </button>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterActivitiesByType('all')">Toutes</button>
                        <button class="filter-btn" onclick="filterActivitiesByType('appel')">Appels</button>
                        <button class="filter-btn" onclick="filterActivitiesByType('email')">Emails</button>
                        <button class="filter-btn" onclick="filterActivitiesByType('r√©union')">R√©unions</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Sujet</th>
                                    <th>Client</th>
                                    <th>Date</th>
                                    <th>Dur√©e</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="activitiesTableBody">
                                <!-- Activities will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tasks Section -->
        <section id="tasks" class="section">
            <div class="header">
                <h2>T√¢ches et rappels</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openModal('taskModal')">
                        ‚ûï Nouvelle t√¢che
                    </button>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterTasksByStatus('all')">Toutes</button>
                        <button class="filter-btn" onclick="filterTasksByStatus('√† faire')">√Ä faire</button>
                        <button class="filter-btn" onclick="filterTasksByStatus('en cours')">En cours</button>
                        <button class="filter-btn" onclick="filterTasksByStatus('termin√©')">Termin√©es</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>T√¢che</th>
                                    <th>Client</th>
                                    <th>Priorit√©</th>
                                    <th>Date limite</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                <!-- Tasks will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="section">
            <div class="header">
                <h2>Rapports et analyses</h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="generateReport()">
                        üìä G√©n√©rer rapport
                    </button>
                    <button class="btn btn-outline" onclick="exportReport()">
                        üì• Exporter PDF
                    </button>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h4>Performance commerciale</h4>
                    <canvas id="salesPerformanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Sources de revenus</h4>
                    <canvas id="revenueSourcesChart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Conversion des opportunit√©s</h4>
                    <canvas id="conversionChart"></canvas>
                </div>
                <div class="chart-container">
                    <h4>Activit√© par type</h4>
                    <canvas id="activityTypeChart"></canvas>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <h3>M√©triques cl√©s</h3>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Taux de conversion</div>
                            <div class="stat-value" id="conversionRate">0%</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Panier moyen</div>
                            <div class="stat-value" id="avgDeal">0‚Ç¨</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Cycle de vente moyen</div>
                            <div class="stat-value" id="avgSalesCycle">0j</div>
                        </div>
                        <div class="stat-card info">
                            <div class="stat-label">ROI Marketing</div>
                            <div class="stat-value" id="marketingROI">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="header">
                <h2>Param√®tres</h2>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <h3>Configuration g√©n√©rale</h3>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nom de l'entreprise</label>
                            <input type="text" id="companyName" value="Mon Entreprise">
                        </div>
                        <div class="form-group">
                            <label>Email de contact</label>
                            <input type="email" id="companyEmail" value="contact@entreprise.fr">
                        </div>
                        <div class="form-group">
                            <label>T√©l√©phone</label>
                            <input type="tel" id="companyPhone" value="+33 1 23 45 67 89">
                        </div>
                        <div class="form-group">
                            <label>Devise</label>
                            <select id="currency">
                                <option value="EUR">EUR (‚Ç¨)</option>
                                <option value="USD">USD ($)</option>
                                <option value="GBP">GBP (¬£)</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary">üíæ Enregistrer les param√®tres</button>
                        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è R√©initialiser toutes les donn√©es</button>
                    </div>
                </div>
            </div>

            <div class="content-card">
                <div class="card-header">
                    <h3>Import / Export de donn√©es</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Importer des donn√©es (CSV)</label>
                        <input type="file" id="importFile" accept=".csv">
                        <button class="btn btn-secondary" style="margin-top: 10px;" onclick="importData()">üì§ Importer</button>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-outline" onclick="exportData('all')">üì• Exporter toutes les donn√©es (CSV)</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Client Modal -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="clientModalTitle">Nouveau client</h3>
                <span class="modal-close" onclick="closeModal('clientModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="clientForm">
                    <input type="hidden" id="clientId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nom complet *</label>
                            <input type="text" id="clientName" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="clientEmail" required>
                        </div>
                        <div class="form-group">
                            <label>T√©l√©phone</label>
                            <input type="tel" id="clientPhone">
                        </div>
                        <div class="form-group">
                            <label>Entreprise</label>
                            <input type="text" id="clientCompany">
                        </div>
                        <div class="form-group">
                            <label>Statut</label>
                            <select id="clientStatus">
                                <option value="actif">Actif</option>
                                <option value="inactif">Inactif</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>CA Total (‚Ç¨)</label>
                            <input type="number" id="clientRevenue" value="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Adresse</label>
                        <textarea id="clientAddress"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="clientNotes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('clientModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveClient()">üíæ Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="contactModalTitle">Nouveau contact</h3>
                <span class="modal-close" onclick="closeModal('contactModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <input type="hidden" id="contactId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nom complet *</label>
                            <input type="text" id="contactName" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="contactEmail" required>
                        </div>
                        <div class="form-group">
                            <label>T√©l√©phone</label>
                            <input type="tel" id="contactPhone">
                        </div>
                        <div class="form-group">
                            <label>Poste</label>
                            <input type="text" id="contactPosition">
                        </div>
                        <div class="form-group">
                            <label>Client associ√©</label>
                            <select id="contactClient">
                                <option value="">S√©lectionner un client</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="contactNotes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('contactModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveContact()">üíæ Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Opportunity Modal -->
    <div id="opportunityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="opportunityModalTitle">Nouvelle opportunit√©</h3>
                <span class="modal-close" onclick="closeModal('opportunityModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="opportunityForm">
                    <input type="hidden" id="opportunityId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Titre *</label>
                            <input type="text" id="opportunityTitle" required>
                        </div>
                        <div class="form-group">
                            <label>Client *</label>
                            <select id="opportunityClient" required>
                                <option value="">S√©lectionner un client</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Montant (‚Ç¨) *</label>
                            <input type="number" id="opportunityAmount" required>
                        </div>
                        <div class="form-group">
                            <label>Probabilit√© (%)</label>
                            <input type="number" id="opportunityProbability" min="0" max="100" value="50">
                        </div>
                        <div class="form-group">
                            <label>Statut</label>
                            <select id="opportunityStatus">
                                <option value="prospection">Prospection</option>
                                <option value="qualification">Qualification</option>
                                <option value="proposition">Proposition</option>
                                <option value="n√©gociation">N√©gociation</option>
                                <option value="gagn√©">Gagn√©</option>
                                <option value="perdu">Perdu</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date de cl√¥ture pr√©vue</label>
                            <input type="date" id="opportunityCloseDate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="opportunityDescription"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('opportunityModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveOpportunity()">üíæ Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Activity Modal -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="activityModalTitle">Nouvelle activit√©</h3>
                <span class="modal-close" onclick="closeModal('activityModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="activityForm">
                    <input type="hidden" id="activityId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Type *</label>
                            <select id="activityType" required>
                                <option value="appel">Appel t√©l√©phonique</option>
                                <option value="email">Email</option>
                                <option value="r√©union">R√©union</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Sujet *</label>
                            <input type="text" id="activitySubject" required>
                        </div>
                        <div class="form-group">
                            <label>Client</label>
                            <select id="activityClient">
                                <option value="">S√©lectionner un client</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date et heure</label>
                            <input type="datetime-local" id="activityDate">
                        </div>
                        <div class="form-group">
                            <label>Dur√©e (minutes)</label>
                            <input type="number" id="activityDuration" value="30">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="activityNotes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('activityModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveActivity()">üíæ Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">Nouvelle t√¢che</h3>
                <span class="modal-close" onclick="closeModal('taskModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <input type="hidden" id="taskId">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Titre de la t√¢che *</label>
                            <input type="text" id="taskTitle" required>
                        </div>
                        <div class="form-group">
                            <label>Client associ√©</label>
                            <select id="taskClient">
                                <option value="">S√©lectionner un client</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priorit√©</label>
                            <select id="taskPriority">
                                <option value="basse">Basse</option>
                                <option value="moyenne">Moyenne</option>
                                <option value="haute">Haute</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date limite</label>
                            <input type="date" id="taskDueDate">
                        </div>
                        <div class="form-group">
                            <label>Statut</label>
                            <select id="taskStatus">
                                <option value="√† faire">√Ä faire</option>
                                <option value="en cours">En cours</option>
                                <option value="termin√©">Termin√©</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="taskDescription"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('taskModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveTask()">üíæ Enregistrer</button>
            </div>
        </div>
    </div>

    <script>
        // ===== DATA MANAGEMENT =====
        let data = {
            clients: [],
            contacts: [],
            opportunities: [],
            activities: [],
            tasks: []
        };

        // Load data from localStorage
        function loadData() {
            const savedData = localStorage.getItem('crmData');
            if (savedData) {
                data = JSON.parse(savedData);
            } else {
                // Initialize with sample data
                initializeSampleData();
            }
            updateAllViews();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('crmData', JSON.stringify(data));
        }

        // Initialize with sample data
        function initializeSampleData() {
            data.clients = [
                { id: 1, name: 'Jean Dupont', email: 'jean.dupont@example.com', phone: '0123456789', company: 'Tech Solutions', status: 'actif', revenue: 25000, address: '123 Rue de Paris, 75001 Paris', notes: 'Client important depuis 2020' },
                { id: 2, name: 'Marie Martin', email: 'marie.martin@example.com', phone: '0234567890', company: 'Innovate Corp', status: 'actif', revenue: 45000, address: '456 Avenue des Champs, 75008 Paris', notes: 'Excellent taux de conversion' },
                { id: 3, name: 'Pierre Bernard', email: 'pierre.bernard@example.com', phone: '0345678901', company: 'Digital Agency', status: 'actif', revenue: 15000, address: '789 Boulevard Saint-Germain, 75006 Paris', notes: '' }
            ];

            data.contacts = [
                { id: 1, name: 'Sophie Laurent', email: 'sophie.laurent@techsolutions.com', phone: '0456789012', position: 'Directrice Marketing', clientId: 1, notes: '' },
                { id: 2, name: 'Luc Moreau', email: 'luc.moreau@innovate.com', phone: '0567890123', position: 'CEO', clientId: 2, notes: 'D√©cideur principal' }
            ];

            data.opportunities = [
                { id: 1, title: 'Projet ERP', clientId: 1, amount: 50000, probability: 75, status: 'n√©gociation', closeDate: '2025-12-15', description: 'Mise en place d\'un syst√®me ERP complet' },
                { id: 2, title: 'Refonte site web', clientId: 2, amount: 25000, probability: 60, status: 'proposition', closeDate: '2025-11-30', description: 'Refonte compl√®te du site corporate' },
                { id: 3, title: 'Formation √©quipe', clientId: 3, amount: 8000, probability: 90, status: 'gagn√©', closeDate: '2025-11-15', description: 'Formation sur les nouvelles technologies' }
            ];

            data.activities = [
                { id: 1, type: 'appel', subject: 'Discussion budget 2025', clientId: 1, date: '2025-11-01T10:00', duration: 45, notes: 'Client int√©ress√© par une extension du contrat' },
                { id: 2, type: 'email', subject: 'Proposition commerciale', clientId: 2, date: '2025-10-30T14:30', duration: 15, notes: 'Envoi de la proposition d√©taill√©e' },
                { id: 3, type: 'r√©union', subject: 'Revue trimestrielle', clientId: 1, date: '2025-10-28T09:00', duration: 120, notes: 'Pr√©sentation des r√©sultats Q3' }
            ];

            data.tasks = [
                { id: 1, title: 'Pr√©parer pr√©sentation client', clientId: 1, priority: 'haute', dueDate: '2025-11-05', status: 'en cours', description: 'Pr√©parer slides pour la r√©union annuelle' },
                { id: 2, title: 'Suivre devis envoy√©', clientId: 2, priority: 'moyenne', dueDate: '2025-11-10', status: '√† faire', description: 'Relancer le client sur le devis du 15/10' },
                { id: 3, title: 'Finaliser contrat', clientId: 3, priority: 'haute', dueDate: '2025-11-03', status: '√† faire', description: 'Faire signer le contrat de formation' }
            ];

            saveData();
        }

        // ===== NAVIGATION =====
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = link.dataset.section;

                // Update active link
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                // Show section
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(section).classList.add('active');

                // Update view for that section
                updateSectionView(section);
            });
        });

        // ===== THEME TOGGLE =====
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateCharts();
        });

        // ===== MODAL MANAGEMENT =====
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');

            // Populate client dropdowns
            if (modalId === 'contactModal' || modalId === 'opportunityModal' || modalId === 'activityModal' || modalId === 'taskModal') {
                populateClientDropdowns();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Reset form
            const formId = modalId.replace('Modal', 'Form');
            document.getElementById(formId).reset();
        }

        function populateClientDropdowns() {
            const selects = ['contactClient', 'opportunityClient', 'activityClient', 'taskClient'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">S√©lectionner un client</option>';
                    data.clients.forEach(client => {
                        select.innerHTML += `<option value="${client.id}">${client.name} - ${client.company || 'N/A'}</option>`;
                    });
                }
            });
        }

        // ===== CLIENTS MANAGEMENT =====
        function saveClient() {
            const id = document.getElementById('clientId').value;
            const client = {
                id: id ? parseInt(id) : Date.now(),
                name: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                company: document.getElementById('clientCompany').value,
                status: document.getElementById('clientStatus').value,
                revenue: parseFloat(document.getElementById('clientRevenue').value) || 0,
                address: document.getElementById('clientAddress').value,
                notes: document.getElementById('clientNotes').value
            };

            if (id) {
                // Update existing
                const index = data.clients.findIndex(c => c.id === parseInt(id));
                data.clients[index] = client;
            } else {
                // Add new
                data.clients.push(client);
            }

            saveData();
            updateClientsView();
            updateStats();
            closeModal('clientModal');
        }

        function updateClientsView() {
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';

            if (data.clients.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üìã</div><h3>Aucun client</h3><p>Commencez par ajouter votre premier client</p></div></td></tr>';
                return;
            }

            data.clients.forEach(client => {
                const statusBadge = client.status === 'actif' ? 'badge-success' : 'badge-danger';
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${client.name}</strong></td>
                        <td>${client.email}</td>
                        <td>${client.phone || 'N/A'}</td>
                        <td>${client.company || 'N/A'}</td>
                        <td><span class="badge ${statusBadge}">${client.status}</span></td>
                        <td><strong>${client.revenue.toLocaleString()}‚Ç¨</strong></td>
                        <td class="action-buttons">
                            <button class="action-btn" onclick="editClient(${client.id})" title="Modifier">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="deleteClient(${client.id})" title="Supprimer">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editClient(id) {
            const client = data.clients.find(c => c.id === id);
            if (!client) return;

            document.getElementById('clientModalTitle').textContent = 'Modifier client';
            document.getElementById('clientId').value = client.id;
            document.getElementById('clientName').value = client.name;
            document.getElementById('clientEmail').value = client.email;
            document.getElementById('clientPhone').value = client.phone || '';
            document.getElementById('clientCompany').value = client.company || '';
            document.getElementById('clientStatus').value = client.status;
            document.getElementById('clientRevenue').value = client.revenue;
            document.getElementById('clientAddress').value = client.address || '';
            document.getElementById('clientNotes').value = client.notes || '';

            openModal('clientModal');
        }

        function deleteClient(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce client ?')) {
                data.clients = data.clients.filter(c => c.id !== id);
                saveData();
                updateClientsView();
                updateStats();
            }
        }

        function filterClients() {
            const search = document.getElementById('clientSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#clientsTableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function filterClientsByStatus(status) {
            // Update active filter button
            document.querySelectorAll('#clients .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const rows = document.querySelectorAll('#clientsTableBody tr');
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    const statusCell = row.querySelector('.badge');
                    if (statusCell && statusCell.textContent.toLowerCase() === status) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // ===== CONTACTS MANAGEMENT =====
        function saveContact() {
            const id = document.getElementById('contactId').value;
            const contact = {
                id: id ? parseInt(id) : Date.now(),
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                phone: document.getElementById('contactPhone').value,
                position: document.getElementById('contactPosition').value,
                clientId: parseInt(document.getElementById('contactClient').value) || null,
                notes: document.getElementById('contactNotes').value
            };

            if (id) {
                const index = data.contacts.findIndex(c => c.id === parseInt(id));
                data.contacts[index] = contact;
            } else {
                data.contacts.push(contact);
            }

            saveData();
            updateContactsView();
            closeModal('contactModal');
        }

        function updateContactsView() {
            const tbody = document.getElementById('contactsTableBody');
            tbody.innerHTML = '';

            if (data.contacts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">üìá</div><h3>Aucun contact</h3><p>Ajoutez vos premiers contacts</p></div></td></tr>';
                return;
            }

            data.contacts.forEach(contact => {
                const client = data.clients.find(c => c.id === contact.clientId);
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${contact.name}</strong></td>
                        <td>${contact.email}</td>
                        <td>${contact.phone || 'N/A'}</td>
                        <td>${contact.position || 'N/A'}</td>
                        <td>${client ? client.name : 'N/A'}</td>
                        <td class="action-buttons">
                            <button class="action-btn" onclick="editContact(${contact.id})" title="Modifier">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="deleteContact(${contact.id})" title="Supprimer">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editContact(id) {
            const contact = data.contacts.find(c => c.id === id);
            if (!contact) return;

            document.getElementById('contactModalTitle').textContent = 'Modifier contact';
            document.getElementById('contactId').value = contact.id;
            document.getElementById('contactName').value = contact.name;
            document.getElementById('contactEmail').value = contact.email;
            document.getElementById('contactPhone').value = contact.phone || '';
            document.getElementById('contactPosition').value = contact.position || '';
            document.getElementById('contactClient').value = contact.clientId || '';
            document.getElementById('contactNotes').value = contact.notes || '';

            openModal('contactModal');
        }

        function deleteContact(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce contact ?')) {
                data.contacts = data.contacts.filter(c => c.id !== id);
                saveData();
                updateContactsView();
            }
        }

        function filterContacts() {
            const search = document.getElementById('contactSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#contactsTableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        // ===== OPPORTUNITIES MANAGEMENT =====
        function saveOpportunity() {
            const id = document.getElementById('opportunityId').value;
            const opportunity = {
                id: id ? parseInt(id) : Date.now(),
                title: document.getElementById('opportunityTitle').value,
                clientId: parseInt(document.getElementById('opportunityClient').value),
                amount: parseFloat(document.getElementById('opportunityAmount').value),
                probability: parseInt(document.getElementById('opportunityProbability').value),
                status: document.getElementById('opportunityStatus').value,
                closeDate: document.getElementById('opportunityCloseDate').value,
                description: document.getElementById('opportunityDescription').value
            };

            if (id) {
                const index = data.opportunities.findIndex(o => o.id === parseInt(id));
                data.opportunities[index] = opportunity;
            } else {
                data.opportunities.push(opportunity);
            }

            saveData();
            updateOpportunitiesView();
            updateStats();
            closeModal('opportunityModal');
        }

        function updateOpportunitiesView() {
            const tbody = document.getElementById('opportunitiesTableBody');
            tbody.innerHTML = '';

            if (data.opportunities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üíº</div><h3>Aucune opportunit√©</h3><p>Cr√©ez votre premi√®re opportunit√©</p></div></td></tr>';
                return;
            }

            data.opportunities.forEach(opp => {
                const client = data.clients.find(c => c.id === opp.clientId);
                let statusBadge = 'badge-primary';
                if (opp.status === 'gagn√©') statusBadge = 'badge-success';
                if (opp.status === 'perdu') statusBadge = 'badge-danger';
                if (opp.status === 'n√©gociation') statusBadge = 'badge-warning';

                tbody.innerHTML += `
                    <tr>
                        <td><strong>${opp.title}</strong></td>
                        <td>${client ? client.name : 'N/A'}</td>
                        <td><strong>${opp.amount.toLocaleString()}‚Ç¨</strong></td>
                        <td>${opp.probability}%</td>
                        <td><span class="badge ${statusBadge}">${opp.status}</span></td>
                        <td>${opp.closeDate ? new Date(opp.closeDate).toLocaleDateString() : 'N/A'}</td>
                        <td class="action-buttons">
                            <button class="action-btn" onclick="editOpportunity(${opp.id})" title="Modifier">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="deleteOpportunity(${opp.id})" title="Supprimer">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editOpportunity(id) {
            const opp = data.opportunities.find(o => o.id === id);
            if (!opp) return;

            document.getElementById('opportunityModalTitle').textContent = 'Modifier opportunit√©';
            document.getElementById('opportunityId').value = opp.id;
            document.getElementById('opportunityTitle').value = opp.title;
            document.getElementById('opportunityClient').value = opp.clientId;
            document.getElementById('opportunityAmount').value = opp.amount;
            document.getElementById('opportunityProbability').value = opp.probability;
            document.getElementById('opportunityStatus').value = opp.status;
            document.getElementById('opportunityCloseDate').value = opp.closeDate;
            document.getElementById('opportunityDescription').value = opp.description || '';

            openModal('opportunityModal');
        }

        function deleteOpportunity(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette opportunit√© ?')) {
                data.opportunities = data.opportunities.filter(o => o.id !== id);
                saveData();
                updateOpportunitiesView();
                updateStats();
            }
        }

        function filterOpportunities() {
            const search = document.getElementById('opportunitySearch').value.toLowerCase();
            const rows = document.querySelectorAll('#opportunitiesTableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function filterOpportunitiesByStatus(status) {
            document.querySelectorAll('#opportunities .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const rows = document.querySelectorAll('#opportunitiesTableBody tr');
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    const statusCell = row.querySelector('.badge');
                    if (statusCell && statusCell.textContent.toLowerCase() === status) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // ===== ACTIVITIES MANAGEMENT =====
        function saveActivity() {
            const id = document.getElementById('activityId').value;
            const activity = {
                id: id ? parseInt(id) : Date.now(),
                type: document.getElementById('activityType').value,
                subject: document.getElementById('activitySubject').value,
                clientId: parseInt(document.getElementById('activityClient').value) || null,
                date: document.getElementById('activityDate').value,
                duration: parseInt(document.getElementById('activityDuration').value),
                notes: document.getElementById('activityNotes').value
            };

            if (id) {
                const index = data.activities.findIndex(a => a.id === parseInt(id));
                data.activities[index] = activity;
            } else {
                data.activities.push(activity);
            }

            saveData();
            updateActivitiesView();
            updateRecentActivities();
            closeModal('activityModal');
        }

        function updateActivitiesView() {
            const tbody = document.getElementById('activitiesTableBody');
            tbody.innerHTML = '';

            if (data.activities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üìû</div><h3>Aucune activit√©</h3><p>Enregistrez votre premi√®re activit√©</p></div></td></tr>';
                return;
            }

            data.activities.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(activity => {
                const client = data.clients.find(c => c.id === activity.clientId);
                const typeIcons = { appel: 'üìû', email: 'üìß', r√©union: 'ü§ù', autre: 'üìù' };

                tbody.innerHTML += `
                    <tr>
                        <td>${typeIcons[activity.type]} ${activity.type}</td>
                        <td><strong>${activity.subject}</strong></td>
                        <td>${client ? client.name : 'N/A'}</td>
                        <td>${activity.date ? new Date(activity.date).toLocaleString() : 'N/A'}</td>
                        <td>${activity.duration} min</td>
                        <td>${activity.notes ? activity.notes.substring(0, 50) + '...' : 'N/A'}</td>
                        <td class="action-buttons">
                            <button class="action-btn" onclick="editActivity(${activity.id})" title="Modifier">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="deleteActivity(${activity.id})" title="Supprimer">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editActivity(id) {
            const activity = data.activities.find(a => a.id === id);
            if (!activity) return;

            document.getElementById('activityModalTitle').textContent = 'Modifier activit√©';
            document.getElementById('activityId').value = activity.id;
            document.getElementById('activityType').value = activity.type;
            document.getElementById('activitySubject').value = activity.subject;
            document.getElementById('activityClient').value = activity.clientId || '';
            document.getElementById('activityDate').value = activity.date;
            document.getElementById('activityDuration').value = activity.duration;
            document.getElementById('activityNotes').value = activity.notes || '';

            openModal('activityModal');
        }

        function deleteActivity(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette activit√© ?')) {
                data.activities = data.activities.filter(a => a.id !== id);
                saveData();
                updateActivitiesView();
                updateRecentActivities();
            }
        }

        function filterActivitiesByType(type) {
            document.querySelectorAll('#activities .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const rows = document.querySelectorAll('#activitiesTableBody tr');
            rows.forEach(row => {
                if (type === 'all') {
                    row.style.display = '';
                } else {
                    const typeCell = row.cells[0].textContent.toLowerCase();
                    if (typeCell.includes(type)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // ===== TASKS MANAGEMENT =====
        function saveTask() {
            const id = document.getElementById('taskId').value;
            const task = {
                id: id ? parseInt(id) : Date.now(),
                title: document.getElementById('taskTitle').value,
                clientId: parseInt(document.getElementById('taskClient').value) || null,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value,
                status: document.getElementById('taskStatus').value,
                description: document.getElementById('taskDescription').value
            };

            if (id) {
                const index = data.tasks.findIndex(t => t.id === parseInt(id));
                data.tasks[index] = task;
            } else {
                data.tasks.push(task);
            }

            saveData();
            updateTasksView();
            updateStats();
            closeModal('taskModal');
        }

        function updateTasksView() {
            const tbody = document.getElementById('tasksTableBody');
            tbody.innerHTML = '';

            if (data.tasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">‚úì</div><h3>Aucune t√¢che</h3><p>Cr√©ez votre premi√®re t√¢che</p></div></td></tr>';
                return;
            }

            data.tasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)).forEach(task => {
                const client = data.clients.find(c => c.id === task.clientId);
                const priorityBadges = { basse: 'badge-info', moyenne: 'badge-warning', haute: 'badge-danger' };
                const statusBadges = { '√† faire': 'badge-warning', 'en cours': 'badge-info', 'termin√©': 'badge-success' };

                tbody.innerHTML += `
                    <tr>
                        <td><strong>${task.title}</strong></td>
                        <td>${client ? client.name : 'N/A'}</td>
                        <td><span class="badge ${priorityBadges[task.priority]}">${task.priority}</span></td>
                        <td>${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'N/A'}</td>
                        <td><span class="badge ${statusBadges[task.status]}">${task.status}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn" onclick="editTask(${task.id})" title="Modifier">‚úèÔ∏è</button>
                            <button class="action-btn" onclick="deleteTask(${task.id})" title="Supprimer">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        function editTask(id) {
            const task = data.tasks.find(t => t.id === id);
            if (!task) return;

            document.getElementById('taskModalTitle').textContent = 'Modifier t√¢che';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskClient').value = task.clientId || '';
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskDueDate').value = task.dueDate;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskDescription').value = task.description || '';

            openModal('taskModal');
        }

        function deleteTask(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette t√¢che ?')) {
                data.tasks = data.tasks.filter(t => t.id !== id);
                saveData();
                updateTasksView();
                updateStats();
            }
        }

        function filterTasksByStatus(status) {
            document.querySelectorAll('#tasks .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const rows = document.querySelectorAll('#tasksTableBody tr');
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    const statusCell = row.querySelector('.badge:last-of-type');
                    if (statusCell && statusCell.textContent.toLowerCase() === status) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // ===== DASHBOARD & STATS =====
        function updateStats() {
            // Total clients
            document.getElementById('totalClients').textContent = data.clients.length;

            // Total revenue
            const totalRevenue = data.clients.reduce((sum, client) => sum + client.revenue, 0);
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString() + '‚Ç¨';

            // Active opportunities
            const activeOpps = data.opportunities.filter(o => !['gagn√©', 'perdu'].includes(o.status)).length;
            document.getElementById('activeOpportunities').textContent = activeOpps;

            // Tasks today
            const today = new Date().toISOString().split('T')[0];
            const tasksToday = data.tasks.filter(t => t.dueDate === today && t.status !== 'termin√©').length;
            document.getElementById('tasksToday').textContent = tasksToday;

            // Conversion rate
            const totalOpps = data.opportunities.length;
            const wonOpps = data.opportunities.filter(o => o.status === 'gagn√©').length;
            const conversionRate = totalOpps > 0 ? ((wonOpps / totalOpps) * 100).toFixed(1) : 0;
            document.getElementById('conversionRate').textContent = conversionRate + '%';

            // Average deal
            const wonAmount = data.opportunities.filter(o => o.status === 'gagn√©').reduce((sum, o) => sum + o.amount, 0);
            const avgDeal = wonOpps > 0 ? (wonAmount / wonOpps).toFixed(0) : 0;
            document.getElementById('avgDeal').textContent = parseInt(avgDeal).toLocaleString() + '‚Ç¨';

            // Average sales cycle (placeholder)
            document.getElementById('avgSalesCycle').textContent = '45j';

            // Marketing ROI (placeholder)
            document.getElementById('marketingROI').textContent = '320%';
        }

        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            container.innerHTML = '';

            const recentActivities = data.activities.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);

            if (recentActivities.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>Aucune activit√© r√©cente</p></div>';
                return;
            }

            const typeIcons = { appel: 'üìû', email: 'üìß', r√©union: 'ü§ù', autre: 'üìù' };

            recentActivities.forEach(activity => {
                const client = data.clients.find(c => c.id === activity.clientId);
                container.innerHTML += `
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">${activity.date ? new Date(activity.date).toLocaleString() : 'Date inconnue'}</div>
                            <div class="timeline-title">${typeIcons[activity.type]} ${activity.subject}</div>
                            <div>${client ? client.name : 'Client non sp√©cifi√©'}</div>
                        </div>
                    </div>
                `;
            });
        }

        // ===== CHARTS =====
        let charts = {};

        function updateCharts() {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDark ? '#f1f5f9' : '#1e293b';
            const gridColor = isDark ? '#334155' : '#e2e8f0';

            const commonOptions = {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        labels: { color: textColor }
                    }
                }
            };

            // Revenue Chart
            if (document.getElementById('revenueChart')) {
                charts.revenue = new Chart(document.getElementById('revenueChart'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Ao√ªt', 'Sep', 'Oct', 'Nov', 'D√©c'],
                        datasets: [{
                            label: 'Revenus (‚Ç¨)',
                            data: [12000, 15000, 18000, 22000, 25000, 28000, 32000, 30000, 35000, 38000, 42000, 45000],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            y: { ticks: { color: textColor }, grid: { color: gridColor } },
                            x: { ticks: { color: textColor }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Opportunities Chart
            if (document.getElementById('opportunitiesChart')) {
                const oppStats = {};
                data.opportunities.forEach(opp => {
                    oppStats[opp.status] = (oppStats[opp.status] || 0) + 1;
                });

                charts.opportunities = new Chart(document.getElementById('opportunitiesChart'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(oppStats),
                        datasets: [{
                            data: Object.values(oppStats),
                            backgroundColor: ['#2563eb', '#10b981', '#f59e0b', '#ef4444', '#06b6d4', '#8b5cf6']
                        }]
                    },
                    options: commonOptions
                });
            }

            // Sales Performance Chart
            if (document.getElementById('salesPerformanceChart')) {
                charts.salesPerformance = new Chart(document.getElementById('salesPerformanceChart'), {
                    type: 'bar',
                    data: {
                        labels: ['T1', 'T2', 'T3', 'T4'],
                        datasets: [{
                            label: 'Objectif',
                            data: [100000, 110000, 120000, 130000],
                            backgroundColor: 'rgba(239, 68, 68, 0.5)'
                        }, {
                            label: 'R√©alis√©',
                            data: [95000, 115000, 118000, 125000],
                            backgroundColor: 'rgba(34, 197, 94, 0.8)'
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            y: { ticks: { color: textColor }, grid: { color: gridColor } },
                            x: { ticks: { color: textColor }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Revenue Sources Chart
            if (document.getElementById('revenueSourcesChart')) {
                charts.revenueSources = new Chart(document.getElementById('revenueSourcesChart'), {
                    type: 'pie',
                    data: {
                        labels: ['Nouveaux clients', 'Clients existants', 'Upsell', 'Renouvellements'],
                        datasets: [{
                            data: [35, 40, 15, 10],
                            backgroundColor: ['#2563eb', '#10b981', '#f59e0b', '#06b6d4']
                        }]
                    },
                    options: commonOptions
                });
            }

            // Conversion Chart
            if (document.getElementById('conversionChart')) {
                charts.conversion = new Chart(document.getElementById('conversionChart'), {
                    type: 'funnel',
                    type: 'bar',
                    data: {
                        labels: ['Leads', 'Qualifi√©s', 'Propositions', 'N√©gociations', 'Gagn√©'],
                        datasets: [{
                            label: 'Nombre',
                            data: [100, 75, 50, 30, 20],
                            backgroundColor: ['#2563eb', '#3b82f6', '#60a5fa', '#93c5fd', '#10b981']
                        }]
                    },
                    options: {
                        ...commonOptions,
                        indexAxis: 'y',
                        scales: {
                            y: { ticks: { color: textColor }, grid: { color: gridColor } },
                            x: { ticks: { color: textColor }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Activity Type Chart
            if (document.getElementById('activityTypeChart')) {
                const activityStats = {};
                data.activities.forEach(act => {
                    activityStats[act.type] = (activityStats[act.type] || 0) + 1;
                });

                charts.activityType = new Chart(document.getElementById('activityTypeChart'), {
                    type: 'polarArea',
                    data: {
                        labels: Object.keys(activityStats),
                        datasets: [{
                            data: Object.values(activityStats),
                            backgroundColor: ['#2563eb', '#10b981', '#f59e0b', '#ef4444']
                        }]
                    },
                    options: commonOptions
                });
            }
        }

        // ===== IMPORT / EXPORT =====
        function exportData(type) {
            let csvContent = '';
            let filename = '';

            if (type === 'clients' || type === 'all') {
                csvContent = 'ID,Nom,Email,T√©l√©phone,Entreprise,Statut,CA Total,Adresse,Notes\n';
                data.clients.forEach(c => {
                    csvContent += `${c.id},"${c.name}","${c.email}","${c.phone}","${c.company}","${c.status}",${c.revenue},"${c.address}","${c.notes}"\n`;
                });
                filename = 'clients.csv';
            }

            if (type === 'all') {
                // Export all data as JSON
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const exportFileDefaultName = 'crm-data-export.json';

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                return;
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.click();
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('Veuillez s√©lectionner un fichier');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (confirm('Voulez-vous remplacer toutes les donn√©es existantes ?')) {
                        data = importedData;
                        saveData();
                        updateAllViews();
                        alert('Donn√©es import√©es avec succ√®s !');
                    }
                } catch (error) {
                    alert('Erreur lors de l\'import : fichier invalide');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ATTENTION : Cette action va supprimer TOUTES les donn√©es du CRM. Cette action est irr√©versible. √ätes-vous s√ªr ?')) {
                if (confirm('Confirmez-vous vraiment vouloir supprimer toutes les donn√©es ?')) {
                    localStorage.removeItem('crmData');
                    data = { clients: [], contacts: [], opportunities: [], activities: [], tasks: [] };
                    updateAllViews();
                    alert('Toutes les donn√©es ont √©t√© supprim√©es.');
                }
            }
        }

        // ===== REPORTS =====
        function generateReport() {
            alert('G√©n√©ration du rapport en cours...\n\n' +
                  'Clients : ' + data.clients.length + '\n' +
                  'Contacts : ' + data.contacts.length + '\n' +
                  'Opportunit√©s : ' + data.opportunities.length + '\n' +
                  'Activit√©s : ' + data.activities.length + '\n' +
                  'T√¢ches : ' + data.tasks.length);
        }

        function exportReport() {
            alert('Export PDF du rapport en d√©veloppement...');
        }

        // ===== UPDATE VIEWS =====
        function updateAllViews() {
            updateClientsView();
            updateContactsView();
            updateOpportunitiesView();
            updateActivitiesView();
            updateTasksView();
            updateStats();
            updateRecentActivities();
            updateCharts();
        }

        function updateSectionView(section) {
            switch(section) {
                case 'dashboard':
                    updateStats();
                    updateRecentActivities();
                    updateCharts();
                    break;
                case 'clients':
                    updateClientsView();
                    break;
                case 'contacts':
                    updateContactsView();
                    break;
                case 'opportunities':
                    updateOpportunitiesView();
                    break;
                case 'activities':
                    updateActivitiesView();
                    break;
                case 'tasks':
                    updateTasksView();
                    break;
                case 'reports':
                    updateCharts();
                    break;
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            updateCharts();
        });
    </script>
</body>
</html>
